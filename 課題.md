
# 10/23
**目標：テクスチャの描画**

**①CustomVertexの改良**
CustomVertexにテクスチャ座標情報を追加
CustomVertexに float TU と float TV を宣言
```
CustomVertex{
    ~~中略~~
    DWORD color;

    float tu;
    float tv;
}
```

**②変数を宣言する**
グローバル変数にLPDIRECT3DTEXTURE9 型の g_Texture を宣言 nullptr で初期化
```
LPDIRECT3DTEXTURE9 g_Texture = nullptr;
```

**③読み込み部分**
グラフィック関数に 戻り値 bool の LoadTexture を宣言 引数は LPCWSTR 型の file_name
中に D3DXCreateTextureFromFile 関数を呼ぶ 引数は (pDevice, LPCWSTR, pTexture)
失敗していたらfalseを返す
```
HRESULT hr = D3DXCreateTextureFromFile(
    g_Device,
    file_name,
    &g_Texture
);

if(FAILED (hr)){
    return false;
}

return true;
```

**④呼び出す**
メインループの上で呼び出す
```
if(LoadTexture(TEXT("ファイル名.拡張子")) == false){
    return 0;
}
```

**⑤テクスチャを開放する**
```
void ReleaseTexture() {
	if ( g_Texture != nullptr ) {
		g_Texture->Release();
		g_Texture = nullptr;
	}
}
```
解放部分で呼び出す
```
ReleaseTexture();
ReleaseDirectGraphics();
```

**⑥ポリゴンを描画する**
```
void DrawPorigonWithTriangleFan() {
	CustomVertex vertices[] = {
		{   0, 400, 0, 1, 0x000000, 0.0f, 0.0f},
		{ 200, 400, 0, 1, 0x000000, 1.0f, 0.0f},
		{ 200, 450, 0, 1, 0x000000, 1.0f, 1.0f},
		{   0, 450, 0, 1, 0x000000, 0.0f, 1.0f}
	};

	g_Device->SetFVF(D3DFVF_XYZRHW | D3DFVF_DIFFUSE | D3DFVF_TEX1 );
}
```
DirectXにポリゴン描画で使用するテクスチャを通知する
```
g_Device->SetTexture( 0, g_Texture );
```

**⑦テクスチャデータを作る**
使用するテクスチャを列挙する
```
enum TextureID{
    TexIDPlayerWalk,
    TexIDPlayerIdle,
    TexIDMax
};
```
`LPDIRECT3DTEXTURE9`の宣言を改良
```
LPDIRECT3DTEXTURE9 g_Textures[TextureID::TexIDMax];
```
テクスチャデータを詰める
```
LPCWSTR g_TextureNameList[] = {
	TEXT( "test.bmp" )
};
```

**⑧コード修正**
g_Texture を g_Texturesに直す
for文で配列の分だけReleaseする など
```
bool LoadTexture( TextureID tex_id ){
	HRESULT hr = D3DXCreateTextureFromFile(
		g_Device,	// DirectX9のデバイス
		g_TextureNameList[tex_id],	// ファイル名
		&g_Textures[tex_id]	// 読み込まれたテクスチャ情報が保存される変数
	);
```
描画関数も修正
```
void DrawPorigonWithTriangleFan( TextureID tex_id ) {
	if ( g_Textures[tex_id] == nullptr ) {
		return;
	}
```